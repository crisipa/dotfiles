# Last Modified: Sun Jun 15 01:23:36 2025
abi <abi/4.0>,

include <tunables/global>

/opt/wechat/wechat {
  include <abstractions/base>
  include <abstractions/dri-common>
  include <abstractions/fonts>
  include <abstractions/gtk>
  include <abstractions/kde-open5>
  include <abstractions/mesa>
  include <abstractions/nameservice>
  include <abstractions/ssl_certs>
  include <abstractions/user-tmp>
  include <abstractions/wayland>

  # æ‹’ç»ç‰¹æƒ
  deny capability sys_admin,
  deny capability sys_chroot,
  deny capability sys_ptrace,

  # é˜»æ­¢ å¾®ä¿¡ 
  deny ptrace read peer=*,
  deny ptrace read peer=/opt/**,
  deny ptrace read peer=/usr/bin/*,

  # ä¸æƒ³è®© å¾®ä¿¡ è®¿é—®çš„ä¸œè¥¿
  deny /dev/disk/** r,
  deny /dev/disk/*/ r,
  deny /etc/* w,
  deny /etc/** w,
  deny /etc/caddy/* r,
  deny /etc/clash* r,
  deny /etc/cmdline.d/* r,
  deny /etc/cron.*/* r,
  deny /etc/nebula/* r,
  deny /etc/nginx/* r,
  deny /etc/ssh/* r,
  deny /etc/wireguard/* r,
  deny /proc/*/cgroup r,
  deny /proc/*/stat r,
  deny /proc/cmdline r,
  deny /proc/config.gz r,
  deny /proc/cpuinfo r,
  deny /proc/sys/fs/inotify/max_user_watches r,
  deny /proc/version r,
  
  # ä¸çŸ¥é“ å¾®ä¿¡ è®¿é—®è¿™äº›å¹²ä»€ä¹ˆ
  deny /sys/bus/pci/devices/ r,
  deny /sys/devices/system/cpu/cpufreq/policy*/cpuinfo_max_freq r,
  deny /sys/devices/system/cpu/kernel_max r,
  deny /sys/devices/virtual/** r,
  deny /usr/bin/bash x,
  
  # ä¸æƒ³è®© å¾®ä¿¡ è®¿é—®çš„ä¸œè¥¿
  deny owner /home/*/.config/chromium/* rw,
  deny owner /home/*/.config/chromium/** rw,
  deny owner /home/*/.mozilla/** rw,
  deny owner /home/*/.pki/nssdb/* w,
  deny owner /home/*/.ssh/* rw,
  deny owner /home/*/.steam/* rw,
  deny owner /home/*/.steam/** rw,
  deny owner /home/*/.sys1og.conf w,
  deny owner /home/*/.var/** rw,
  deny owner /home/*/Documents/* rw,

  # åŸŸåè§£æ
  /etc/hosts r,
  /etc/resolv.conf r,
  
  # å¾®ä¿¡ çš„æ–‡ä»¶
  /opt/wechat/* r,
  /opt/wechat/** r,
  /opt/wechat/*.so mr,
  /opt/wechat/RadiumWMPF/host/*.so mr,
  /opt/wechat/RadiumWMPF/runtime/*.so mr,
  /opt/wechat/RadiumWMPF/runtime/WeChatAppEx mrix,
  /opt/wechat/RadiumWMPF/runtime/WeChatAppEx_crashpad_handler mrix,
  /opt/wechat/crashpad_handler mrix,
  /opt/wechat/wechat mr,
  /opt/wechat/wxocr mrix,
  /opt/wechat/wxplayer mrix,
  /opt/wechat/wxutility mrix,
  /proc/self/exe mrix,
  
  # ä¸çŸ¥é“ å¾®ä¿¡ è®¿é—®è¿™äº›å¹²ä»€ä¹ˆ
  /proc/sys/kernel/yama/ptrace_scope r,
  /sys/devices/system/cpu/present r,
  /usr/share/icons/** r,
  audit /etc/hostname r,
  audit /proc/ r,
  audit /sys/class/net/ r,
  
  # ç½‘å¡åœ°å€
  audit /sys/devices/pci*/**/en*/address r,
  audit /sys/devices/pci*/**/et*/address r,
  audit /sys/devices/pci*/**/wl*/address r,
  
  # amd æ ¸æ˜¾
  audit /sys/devices/pci0000:00/0000:00:08.1/0000:36:00.0/* r,
  
  # æœ¬åœ°åœ°å€
  audit /sys/devices/virtual/net/lo/address r,
  
  # ç”µå­åƒåœ¾ğŸ˜¡
  audit owner /dev/shm/.org.chromium.Chromium.* rw,
  
  # è®© qq è®¿é—® ä¸‹è½½ æ–‡ä»¶å¤¹
  audit owner /home/*/Downloads/* rw,
  
  # x11 çª—å£ğŸ˜¡
  audit owner /run/user/1000/xauth_* r,
  
  # æ¡Œé¢é…ç½®
  owner /home/*/.config/gtk-*/* r,
  owner /home/*/.config/kdedefaults/kdeglobals r,
  owner /home/*/.config/kdeglobals r,
  owner /home/*/.config/user-dirs.dirs r,
  
  # å¾®ä¿¡ çš„ç”¨æˆ·æ•°æ®
  owner /home/*/.pki/nssdb/* r,
  owner /home/*/.xwechat/** rwk,
  owner /home/*/Documents/xwechat_files/** rwk,
  
  # å¾®ä¿¡ çš„ proc ï¼Ÿ
  owner /proc/*/cmdline r,
  owner /proc/*/fd/ r,
  owner /proc/*/mem r,
  owner /proc/*/oom_score_adj w,
  owner /proc/*/setgroups w,
  owner /proc/*/stat r,
  owner /proc/*/statm r,
  owner /proc/*/task/ r,
  owner /proc/*/task/** r,

  userns create,

}
