# Last Modified: Sun Jun 15 01:03:06 2025
abi <abi/4.0>,

include <tunables/global>

/opt/QQ/qq {
  include <abstractions/base>
  include <abstractions/dbus-session-strict>
  include <abstractions/dri-common>
  include <abstractions/fonts>
  include <abstractions/gtk>
  include <abstractions/mesa>
  include <abstractions/nameservice>
  include <abstractions/ssl_certs>
  include <abstractions/user-tmp>
  include <abstractions/wayland>

  # ä¸ç»™ç‰¹æƒä¸å¯åŠ¨
  capability sys_admin,
  capability sys_chroot,
  capability sys_ptrace,

  # ä¸æƒ³è®© qq è®¿é—®çš„ä¸œè¥¿
  deny /dev/disk/** r,
  deny /dev/disk/*/ r,
  deny /etc/* w,
  deny /etc/** w,
  deny /etc/caddy/* r,
  deny /etc/clash* r,
  deny /etc/cmdline.d/* r,
  deny /etc/cron.*/* r,
  deny /etc/nebula/* r,
  deny /etc/nginx/* r,
  deny /etc/ssh/* r,
  deny /etc/wireguard/* r,
  deny /proc/*/stat r,
  deny /proc/cmdline r,
  deny /proc/config.gz r,
  deny /proc/cpuinfo r,
  deny /proc/sys/fs/inotify/max_user_watches r,
  deny /proc/version r,
  deny /sys/devices/** r,
  
  # ä¸æƒ³è®© qq è®¿é—®çš„ä¸œè¥¿
  deny owner /home/*/.config/chromium/* rw,
  deny owner /home/*/.config/chromium/** rw,
  deny owner /home/*/.mozilla/** rw,
  deny owner /home/*/.pki/nssdb/* w,
  deny owner /home/*/.ssh/* rw,
  deny owner /home/*/.steam/* rw,
  deny owner /home/*/.steam/** rw,
  deny owner /home/*/.var/** rw,
  deny owner /home/*/Documents/* rw,
  deny owner /home/*/Documents/** rw,

  # åŸŸåè§£æ
  /etc/hosts r,
  /etc/resolv.conf r,
  
  # qq çš„æ–‡ä»¶
  /opt/QQ/* r,
  /opt/QQ/** r,
  /opt/QQ/*.so mr,
  /opt/QQ/*.so.* mr,
  /opt/QQ/chrome_crashpad_handler mrix,
  /opt/QQ/qq mrix,
  /opt/QQ/resources/app/*.node mr,
  /opt/QQ/resources/app/*.so mr,
  /opt/QQ/resources/app/*.so.* mr,
  
  # ä¸çŸ¥é“ qq è®¿é—®è¿™äº›å¹²ä»€ä¹ˆ
  /proc/sys/kernel/yama/ptrace_scope r,
  /sys/devices/system/cpu/present r,
  /usr/lib/ r,
  /usr/share/fcitx5/themes/default/theme.conf r,
  
  # æ¡Œé¢é…ç½®
  /usr/share/icons/** r,
  /usr/share/mime/mime.cache r,
  /var/lib/flatpak/exports/share/mime/mime.cache r,
  
  # ä¸çŸ¥é“ qq è®¿é—®è¿™äº›å¹²ä»€ä¹ˆ
  audit /proc/ r,
  audit /sys/bus/pci/devices/ r,
  
  # amd æ ¸æ˜¾
  audit /sys/devices/pci0000:00/0000:00:08.1/0000:36:00.0/* r,
  
  # ä¸çŸ¥é“ qq è®¿é—®è¿™äº›å¹²ä»€ä¹ˆ
  audit /usr/bin/ldd r,
  
  # ç”µå­åƒåœ¾ğŸ˜¡
  audit owner /dev/shm/.org.chromium.Chromium.* rw,
  
  # è®© qq è®¿é—® ä¸‹è½½ æ–‡ä»¶å¤¹
  audit owner /home/*/Downloads/* rw,
  
  # x11 çª—å£ğŸ˜¡
  audit owner /run/user/1000/xauth_* r,
  
  # å­—ä½“
  owner /home/*/.cache/fontconfig/* r,
  
  # qq çš„ç”¨æˆ·æ•°æ®
  owner /home/*/.config/QQ/** rwk,
  
  # å­—ä½“åŠæ¡Œé¢é…ç½®
  owner /home/*/.config/fontconfig/fonts.conf r,
  owner /home/*/.config/gtk-*/* r,
  owner /home/*/.config/user-dirs.dirs r,
  owner /home/*/.local/share/mime/mime.cache r,
  
  # sslè¯ä¹¦
  owner /home/*/.pki/nssdb/* rk,
  
  # qq çš„ proc ï¼Ÿ
  owner /proc/*/cgroup r,
  owner /proc/*/cmdline r,
  owner /proc/*/fd/ r,
  owner /proc/*/gid_map w,
  owner /proc/*/loginuid r,
  owner /proc/*/mounts r,
  owner /proc/*/oom_score_adj w,
  owner /proc/*/setgroups w,
  owner /proc/*/stat r,
  owner /proc/*/statm r,
  owner /proc/*/task/ r,
  owner /proc/*/task/*/status r,
  owner /proc/*/uid_map w,

  userns create,

}
